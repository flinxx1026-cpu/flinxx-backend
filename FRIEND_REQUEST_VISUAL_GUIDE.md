# Friend Request Flow - Visual Guide

## ğŸ“Œ Three Different Screens, Three Different Places

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER'S DASHBOARD                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ“· Video Chat Screen - Partner View                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚                                      â”‚   â† GREEN ICON HERE     â”‚
â”‚  â”‚     Video of Partner          ğŸ‘¤   âš ï¸  â”‚   (Profile Icon)      â”‚
â”‚  â”‚                                      â”‚   â† CLICK = Send FR     â”‚
â”‚  â”‚                                      â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                  â”‚
â”‚ ACTION: Click green icon â†’ Sends REAL friend request             â”‚
â”‚ RESULT: Creates database entry â†’ Other user gets POPUP           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ Friends & Requests Panel (When You Click â¤ï¸ Icon)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â¤ï¸ Friends & Requests           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚  ğŸ’š Incoming Requests (1)        â”‚  â† SECTION 1: NEW!
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚     Requests FROM others
â”‚  ğŸ‘¤ User A                        â”‚
â”‚     â³ Wants to be your friend    â”‚
â”‚     [âœ“ Accept] [âœ• Reject]        â”‚
â”‚                                  â”‚
â”‚  ğŸ“¤ Sent Requests (2)            â”‚  â† SECTION 2: Your requests
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚     Requests TO others
â”‚  ğŸ‘¤ User B                        â”‚
â”‚     â³ Request sent              â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3ï¸âƒ£ Popup When Receiving Request

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           [X]                  â”‚  â† Close button
â”‚                                â”‚
â”‚        ğŸ‘¤                       â”‚  â† Sender's avatar
â”‚                                â”‚
â”‚    User A                      â”‚
â”‚    wants to be your friend     â”‚
â”‚                                â”‚
â”‚  [Reject]          [Accept]    â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When appears: When someone sends you a request
Appears on: Your dashboard screen (any screen)
```

---

## ğŸ”„ Complete Request Lifecycle

### SENDER'S PERSPECTIVE:

```
STEP 1: In Video Chat
   Video Chat Screen
   â””â”€ Click ğŸŸ¢ Profile Icon
   
STEP 2: Send Request
   sendQuickInvite() 
   â””â”€ Calls /api/friends/send
   
STEP 3: In Friends & Requests
   â¤ï¸ Panel opens
   â””â”€ Section 2: "ğŸ“¤ Sent Requests"
   â””â”€ Shows "User X - Request sent"
   â””â”€ Status: â³ Request sent (until accepted)

STEP 4: After Accepted
   â””â”€ Status changes to: "âœ“ Friends"
   â””â”€ Can click Message button
```

### RECEIVER'S PERSPECTIVE:

```
STEP 1: Other User Sends Request
   [Anywhere on their dashboard]
   
STEP 2: You GET POPUP
   ğŸ”” Popup appears (wherever you are)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User X              â”‚
   â”‚ wants to be friend  â”‚
   â”‚ [âœ“] [âœ•]           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
STEP 3: You Accept/Reject from Popup
   Click âœ“ Accept
   â””â”€ Popup closes
   â””â”€ Request becomes "accepted"
   
STEP 4: View in Friends & Requests
   Click â¤ï¸ icon
   â””â”€ Section 1: "ğŸ’š Incoming Requests"
   â””â”€ Shows "User X - âœ“ Friends"
   â””â”€ Can now Message them
   
OR

STEP 3 ALT: Ignore Popup, Check Panel Later
   Click â¤ï¸ icon
   â””â”€ Section 1: "ğŸ’š Incoming Requests"
   â””â”€ Shows "User X - Wants to be friend"
   â””â”€ Can Accept/Reject from panel
```

---

## ğŸ“ Key Locations

| Location | Icon | What Shows | API Used |
|----------|------|-----------|----------|
| **Video Chat Screen** | ğŸŸ¢ Profile | Send friend request button | `/api/friends/send` |
| **Friends Panel - Section 1** | ğŸ’š Incoming | Requests FROM others | `/api/notifications` |
| **Friends Panel - Section 2** | ğŸ“¤ Sent | Requests TO others | AuthContext |
| **Popup (Anywhere)** | ğŸ”” Toast | Real-time notification | Socket event |

---

## âœ… Important Rules

### DO:
- âœ… Send requests from profile icon (creates database entry)
- âœ… Show popup when receiving request (real-time)
- âœ… Display incoming requests in Friends & Requests panel
- âœ… Keep search modal SEPARATE (no friend requests there)

### DON'T:
- âŒ Send socket-only ephemeral requests
- âŒ Mix requests with search results
- âŒ Show incoming requests in search modal
- âŒ Use multiple notification refresh calls

---

## ğŸš€ Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SENDER: Clicks ğŸŸ¢ Profile Icon in Video Chat              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ sendQuickInvite()        â”‚
        â”‚ Calls:                   â”‚
        â”‚ /api/friends/send        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚
        â–¼                          â–¼
    SENDER             RECEIVER
    Send Side          Receive Side
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend Creates:    â”‚
    â”‚ â€¢ DB Entry          â”‚
    â”‚ â€¢ Socket Event      â”‚
    â”‚ â€¢ "friend_request"  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â”‚           â”‚
        â–¼           â–¼
    SENDER      RECEIVER
    View in     See
    Panel â¤ï¸    Popup ğŸ””
    
    Section 2:      "User wants to
    "Sent X"        be your friend"
    
    Next: Can       Next: Can
    Accept/Reject   Accept/Reject
    from panel      from popup
```

---

## ğŸ¯ Test Scenarios

### Test 1: Send from Profile Icon
1. Start video chat with someone
2. Click ğŸŸ¢ profile icon
3. âœ… Should see send request button
4. Click to send
5. Other person should SEE POPUP

### Test 2: View in Friends Panel
1. Click â¤ï¸ hearts icon
2. âœ… Should see "ğŸ’š Incoming Requests"
3. âœ… Should see "ğŸ“¤ Sent Requests"
4. Try Accept/Reject buttons
5. Status should update

### Test 3: Accept Request
- From POPUP: Click Accept â†’ Popup closes
- From PANEL: Click Accept button â†’ Status updates
- Both should work the same way

### Test 4: Check Not in Search
1. Open search modal
2. âœ… Should NOT show friend requests
3. Search results should be SEPARATE
4. Friend requests are ONLY in:
   - Popup ğŸ””
   - Friends & Requests panel â¤ï¸

---

**Last Updated:** February 10, 2025
**Status:** âœ… Ready for Testing
